{"version":3,"file":"index.js","sources":["../../src/decorators/utils.ts","../../src/decorators/Action.ts","../../src/decorators/ExportVuexStore.ts","../../src/decorators/Getter.ts","../../src/decorators/HasGetter.ts","../../src/decorators/HasGetterAndMutation.ts","../../src/decorators/Mutation.ts","../../src/decorators/VuexClass.ts"],"sourcesContent":["import { Module, GetterTree, MutationTree } from 'vuex';\n\nexport interface AverModule<S, R> extends Module<S, R> {\n  moduleName?: string;\n  persistent?: string[] | boolean;\n}\n\ninterface Store<S, R> {\n  [key: string]: AverModule<S, R>;\n}\n\nexport const stores: Store<any, any> = {};\n\nexport function assignStates<S>(Obj: any) {\n  const target = new Obj();\n  const props = Object.getOwnPropertyNames(target);\n  if (typeof target.moduleName === 'undefined') {\n    console.error(\n      `You need to define the 'moduleName' class variable inside '${target.constructor.name}'! Otherwise it won't be added to the Vuex Store!`\n    );\n  }\n\n  initStore(target);\n\n  stores[getClassName(target)].moduleName = target.moduleName;\n  props.splice(props.indexOf('moduleName'), 1);\n\n  const stateFactory = () => getStates(target, props);\n  stores[getClassName(target)].state = stateFactory;\n\n  const proto = Object.getPrototypeOf(target);\n  const functions = Object.getOwnPropertyNames(proto);\n\n  const getters = {} as GetterTree<S, any>;\n  const mutations = {} as MutationTree<S>;\n\n  for (const func of functions) {\n    const descriptor = Object.getOwnPropertyDescriptor(proto, func);\n    if (descriptor && descriptor.get) {\n      getters[func] = (\n        state: S,\n        getters: GetterTree<S, any>,\n        rootState: any,\n        rootGetters: GetterTree<any, any>\n      ) => {\n        const thisObject = {\n          $store: { state, getters, rootState, rootGetters },\n        };\n        for (const key of Object.keys(state)) {\n          Object.defineProperty(thisObject, key, {\n            get: () => (state as any)[key],\n          });\n        }\n        const output = (descriptor.get as Function).call(thisObject);\n        return output;\n      };\n    } else if (descriptor && descriptor.set) {\n      mutations[func] = (state: S, payload: any) => {\n        (descriptor.set as Function).call(state, payload);\n      };\n    }\n  }\n\n  Object.assign(stores[getClassName(target)].getters, getters);\n  Object.assign(stores[getClassName(target)].mutations, mutations);\n}\n\nexport function getStates<T>(target: T, props: string[]) {\n  const s: { [key: string]: any } = {};\n  for (const prop of props) {\n    s[prop] = (target as any)[prop];\n  }\n  return s;\n}\n\nexport function initStore<T>(target: T): void {\n  // tslint:disable-next-line: strict-type-predicates\n  if (typeof stores[getClassName(target)] === 'undefined') {\n    stores[getClassName(target)] = {\n      namespaced: true,\n      state: () => {\n        return {};\n      },\n      getters: {},\n      actions: {},\n      mutations: {},\n    };\n  }\n}\n\nexport function getClassName(Obj: any): string {\n  let target = new Obj.constructor();\n  if (typeof target === 'function') target = new Obj();\n  return target.moduleName;\n}\n","import { ActionContext, Action as VuexAction } from 'vuex';\nimport { stores, initStore, getClassName } from './utils';\n\nexport default function Action<T, R>(\n  target: T,\n  key: string | symbol,\n  descriptor: TypedPropertyDescriptor<(...args: any[]) => R>\n) {\n  initStore(target);\n\n  const action: VuexAction<typeof target, any> = async function (\n    context: ActionContext<any, any>,\n    payload: any\n  ) {\n    const thisObject = { $store: context };\n    for (const key of Object.keys(context.state)) {\n      Object.assign(thisObject, { [key]: context.state[key] });\n    }\n    return (target as any)[key].call(thisObject, payload);\n  };\n\n  stores[getClassName(target)].actions![key as string] = action;\n}\n","import { stores, getClassName, AverModule } from './utils';\n\nexport default function ExportVuexStore<S, R, T>(\n  target: T,\n  exportAsReadyObject = false\n): AverModule<S, R> | { [key: string]: AverModule<S, R> } {\n  const name = getClassName(target);\n  if (!exportAsReadyObject) return stores[name];\n  else return { [name]: stores[name] };\n}\n","import { Getter } from 'vuex';\nimport { stores, initStore, getClassName } from './utils';\n\nexport default function Getter<T, R>(\n  target: T,\n  key: string | symbol,\n  descriptor: TypedPropertyDescriptor<(...args: any[]) => R>\n) {\n  initStore(target);\n  stores[getClassName(target)].getters![key as string] = <S, R>(\n    state: S,\n    getters: any,\n    rootState: R,\n    rootGetters: any\n  ) => {\n    const thisObject = { $store: { state, getters, rootState, rootGetters } };\n    for (const key of Object.keys(state)) {\n      Object.assign(thisObject, { [key]: (state as any)[key] });\n    }\n    const output = (target as any)[key].call(thisObject);\n    return output;\n  };\n}\n","import { stores, initStore, getClassName } from './utils';\n\nexport default function HasGetter<T>(target: T, key: string | symbol) {\n  initStore(target);\n  stores[getClassName(target)].getters![key as string] = (state: any) =>\n    state[key];\n}\n","import Vue from 'vue';\nimport { stores, initStore, getClassName } from './utils';\n\nexport default function HasGetterAndMutation<T>(\n  target: T,\n  key: string | symbol\n) {\n  initStore(target);\n  stores[getClassName(target)].getters![key as string] = (state) => state[key];\n  stores[getClassName(target)].mutations![key as string] = (state, val) => {\n    Vue.set(state, key as string, val);\n  };\n}\n","import { stores, initStore, getClassName } from './utils';\n\nexport default function Mutation<T, R>(\n  target: T,\n  key: string | symbol,\n  descriptor: TypedPropertyDescriptor<(...args: any[]) => R>\n) {\n  initStore(target);\n  stores[getClassName(target)].mutations![key as string] = <S, R>(\n    state: S,\n    payload: R\n  ) => {\n    (target as any)[key].call(state, payload);\n  };\n}\n","import ExportVuexStore from './ExportVuexStore';\nimport { stores, assignStates, getClassName } from './utils';\nimport { ActionContext } from 'vuex';\n\ninterface VuexClassOptions {\n  persistent?: Array<string>;\n  extend?: Array<any>;\n}\n\nexport class VuexModule<S = ThisType<any>, R = any> {\n  $store!: ActionContext<S, R>;\n}\n\nexport function VuexClass<S>(module?: Function): void;\nexport function VuexClass<S>(options?: VuexClassOptions): ClassDecorator;\n\nexport function VuexClass<S>(options?: VuexClassOptions | Function) {\n  if (typeof options === 'function') {\n    assignStates(options);\n  } else {\n    return (target: S) => {\n      assignStates(target);\n\n      const store = stores[getClassName(target)];\n\n      for (const obj of options?.extend || []) {\n        const extendStore = ExportVuexStore<any, any, typeof target>(obj);\n        const oldState = store.state();\n        const newState = extendStore.state();\n        const stateFactory = () => Object.assign(oldState, newState);\n        store.state = stateFactory;\n        Object.assign(store.getters, extendStore.getters);\n        Object.assign(store.actions, extendStore.actions);\n        Object.assign(store.mutations, extendStore.mutations);\n      }\n\n      if (options?.persistent) store.persistent = options.persistent;\n      else store.persistent = false;\n    };\n  }\n}\n"],"names":[],"mappings":"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"}